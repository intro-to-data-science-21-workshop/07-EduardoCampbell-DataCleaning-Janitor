<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Cleaning dirty data with janitor</title>

<script src="janitor_workshop_exercises_files/header-attrs-2.11/header-attrs.js"></script>
<script src="janitor_workshop_exercises_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="janitor_workshop_exercises_files/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="janitor_workshop_exercises_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="janitor_workshop_exercises_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="janitor_workshop_exercises_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="janitor_workshop_exercises_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="janitor_workshop_exercises_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="janitor_workshop_exercises_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="janitor_workshop_exercises_files/navigation-1.1/tabsets.js"></script>
<link href="janitor_workshop_exercises_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="janitor_workshop_exercises_files/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="custom.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">Cleaning dirty data with janitor</h1>
<h3 class="subtitle">Workshop Presentation</h3>

</div>


<div id="why-janitor" class="section level2">
<h2>Why Janitor? 💻</h2>
<p>A new survey of data scientists conducted by CrowdFlower found that they spend most of their time cleaning rather than mining or modeling data. The survey indicates that data scientists spend 60% of their time on cleaning and organizing data. - <a href="https://www.forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/?sh=1ee110d86f63">Cleaning Big Data: Most Time-Consuming, Least Enjoyable Data Science Task, Survey Says</a></p>
<p><img src="datastats.jpg" /><!-- --></p>
<p>As a budding data scientist, do you feel like you spend a lot of time <strong>tidying</strong> data? Renaming columns, deleting unnecessary information, wrangling data into <code>tidy data</code> format? If your answer to this question is yes, this session is for you.✨</p>
<p>The janitor package is an excellent tool due to its user-friendly approach. The creators of this package aimed to facilitate a tool for beginning and intermediate R users. Advanced R users could do most of the janitor package functions without it, but janitor will save them time.</p>
</div>
<div id="janitor" class="section level2">
<h2>Janitor ✨</h2>
<p>The janitor package is a R package that has simple functions for examining and cleaning dirty data. While cleaning and exploring data are some of its key functions, janitor also offers some functions to create and format frequency tables.</p>
<p>Due to time constraints, we will not be able to cover all the functions. However, if you are interested to learn what the other functions are, find them on this <a href="http://sfirke.github.io/janitor/reference/index.html">link</a>.</p>
<p>The main janitor functions:</p>
<ul>
<li>perfectly format <code>data.frame</code> column names</li>
<li>create and format frequency tables of one, two, or three variables (an improved `<code>table()</code> function)</li>
<li>provide other tools for cleaning and examining data.frames</li>
</ul>
<p>It is important to note that janitor is a <strong>tidyverse-oriented package</strong>. In other words, it plays nicely with the %&gt;% pipe and is optimized for cleaning data brought in with the readr and readxl packages.</p>
<p>In this presentation you will learn:</p>
<ul>
<li>what we mean by dirty data</li>
<li>how to save time cleaning data</li>
<li>key functions of the janitor package</li>
</ul>
<p>The presentation will be divided into two parts:</p>
<ol style="list-style-type: decimal">
<li>Cleaning a dirty dataset</li>
<li>Creating and editing table</li>
</ol>
</div>
<div id="section-1-cleaning-a-dirty-dataset" class="section level2">
<h2>Section 1: Cleaning a dirty dataset</h2>
<div id="clean_names" class="section level3">
<h3><code>clean_names()</code> 👩‍💻</h3>
<p>This function works in a %&gt;% pipeline, and it handles problematic variable names. Some of the things that <code>clean_names()</code>does are:</p>
<ul>
<li>Returns names with only lowercase letters, with _ as a separator</li>
<li>Handles special characters and spaces</li>
<li>Appends numbers to duplicated names</li>
<li>Converts “%” to “percent” to retain meaning</li>
<li>Converts “#” to “number” to retain meaning</li>
</ul>
</div>
<div id="row_to_names" class="section level3">
<h3><code>row_to_names()</code></h3>
<p>If a dataset has the intended variable names stored in one of its rows, <code>row_to_names</code> will elevate the specified row to become the names of the data.frame and optionally (by default) remove the row in which names were stored and/or the rows above it.</p>
</div>
<div id="remove_empty" class="section level3">
<h3><code>remove_empty()</code></h3>
<p>The remove_empty() function removes any columns that are entirely empty and entire rows that are entirely empty.</p>
</div>
<div id="get_dupes" class="section level3">
<h3><code>get_dupes()</code></h3>
<p>This function is for hunting down and examining duplicate records during data cleaning. <code>get_dupes()</code>returns the records (and inserts a count of duplicates) so you can examine the problematic cases</p>
</div>
<div id="remove_constant" class="section level3">
<h3><code>remove_constant()</code></h3>
<p>This function drops columns from a data.frame that contain only a single constant value (with an <code>na.rm</code> option to control whether NAs should be considered as different values from the constant).</p>
</div>
<div id="excel_numeric_to_date" class="section level3">
<h3><code>excel_numeric_to_date()</code></h3>
<p>Ever load data from Excel and see a value like 42223 where a date should be? This function converts those serial numbers to class Date, with options for different Excel date encoding systems</p>
</div>
<div id="theory-into-practice" class="section level3">
<h3>Theory into practice 🎒</h3>
<p>Let’s first observe how the data looks originally on excel</p>
<p><img src="Picture6.jpg" width="100%" style="display: block; margin: auto;" /></p>
<p>Let’s load the excel file and check how it loads in R.</p>
<p><img src="dirtydata.png" /><!-- --></p>
<p>We can see there are several problems with this data:</p>
<ul>
<li>The column names are in the second row</li>
<li>There are columns which don’t have any data in them</li>
<li>The ‘date RSVP’ column has a mixed format</li>
<li>And more…</li>
</ul>
<div id="lets-use-the-janitor-package-to-clean-the-data." class="section level4">
<h4>Let’s use the <strong>janitor</strong> package to clean the data.</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>party <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;party.xlsx&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>party_clean <span class="ot">&lt;-</span> party <span class="sc">%&gt;%</span>    <span class="co"># Select the row which contains the column headers</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_to_names</span>(<span class="at">row_number =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># Return column names in snake case</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;rows&quot;</span>, <span class="st">&quot;cols&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove empty rows and columns</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_constant</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_rsvp =</span> <span class="fu">convert_to_date</span>(date_rsvp,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">character_fun =</span> lubridate<span class="sc">::</span>dmy),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">as.numeric</span>(year),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">allergies =</span> <span class="fu">tolower</span>(allergies),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">paid_for_ticket =</span> <span class="fu">tolower</span>(paid_for_ticket),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">rsvp =</span> <span class="fu">tolower</span>(rsvp))</span></code></pre></div>
<p><img src="cleandata.png" /><!-- --></p>
<p>Now we have removed the useless first row by using the <code>row_to_names</code> function and made the column names clearer using <code>clean_names</code>. We also removed the empty columns and rows. Finally, we also tidied the variables, making the date format clearer and the variables lower case. To do this we used a couple of <code>tidyverse</code> functions in addition to the <code>janitor</code> package, demonstrating how <code>janitor</code> is integrated with the broader <code>tidyverse</code>.</p>
</div>
</div>
</div>
<div id="section-2-creating-and-editing-tables" class="section level2">
<h2>Section 2: Creating and editing tables 🖊</h2>
<p>This section is not related to data cleaning per se, but creating compelling tables is a critical part of preparing data, and of the broader data science workflow.</p>
<div id="tabyl" class="section level3">
<h3><code>tabyl()</code> ✍️</h3>
<p>Janitor also offers a version of the <code>table()</code> function from base R, but in a much more powerful form. It is very useful for understanding tables and providing extra information that the function <code>table()</code> from base R does not offer.</p>
<p><code>tabyl()</code> takes a vector and returns a frequency table, like <code>table()</code>. Nevertheless, some of its additional features are:</p>
<ul>
<li>It returns a data.frame - for manipulating further, or printing with knitr::kable().</li>
<li>It automatically calculates percentages</li>
<li>It can (optionally) display NA values</li>
<li>When NA values are present, it will calculate an additional column valid_percent</li>
<li>It can (optionally) sort on counts</li>
<li>It can be called with %&gt;% in a pipeline</li>
<li>When called on a factor, it will include missing levels in the result (levels not present in the vector)</li>
</ul>
</div>
<div id="compare_df_cols" class="section level3">
<h3><code>compare_df_cols()</code></h3>
<p>Generate a comparison of data.frames (or similar objects) that indicates if they will successfully bind together by rows.</p>
</div>
<div id="adorn_totals" class="section level3">
<h3><code>adorn_totals()</code></h3>
<p>Append a totals row and/or column to a data.frame</p>
</div>
<div id="adorn_percentage" class="section level3">
<h3><code>adorn_percentage()</code></h3>
<p>Convert a data.frame of counts to percentages</p>
</div>
<div id="adorn_pct_formatting" class="section level3">
<h3><code>adorn_pct_formatting()</code></h3>
<p>Format a data.frame of decimals as percentages</p>
</div>
<div id="adorn_ns" class="section level3">
<h3><code>adorn_ns()</code></h3>
<p>Add underlying Ns to a tabyl displaying percentages</p>
</div>
<div id="adorn_title" class="section level3">
<h3><code>adorn_title()</code></h3>
<p>Add column name to the top of a two-way tabyl</p>
</div>
</div>
<div id="whats-next" class="section level2">
<h2>What’s next? 😄</h2>
<p>Thanks for listening! Check out the tutorial, coming up next, for more hands-on practice with janitor functions.</p>
</div>
<div id="sources" class="section level2">
<h2>Sources 📜</h2>
<ul>
<li><a href="https://github.com/sfirke/janitor" class="uri">https://github.com/sfirke/janitor</a></li>
<li><a href="https://garthtarr.github.io/meatR/janitor.html#crosstabulation" class="uri">https://garthtarr.github.io/meatR/janitor.html#crosstabulation</a></li>
<li><a href="https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html" class="uri">https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html</a></li>
<li><a href="https://rdrr.io/cran/janitor/" class="uri">https://rdrr.io/cran/janitor/</a></li>
<li><a href="https://medium.com/@verajosemanuel/janitor-a-good-r-package-for-data-cleaning-f3c733632ad9" class="uri">https://medium.com/@verajosemanuel/janitor-a-good-r-package-for-data-cleaning-f3c733632ad9</a></li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
